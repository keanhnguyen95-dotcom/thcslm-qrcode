<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng Gi√°m s√°t Ph√≤ng B·ªánh</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .control-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .recording-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .record-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
            animation: blink 1s infinite;
        }

        .record-indicator.active {
            background: #e74c3c;
        }

        .record-indicator.stopped {
            background: #95a5a6;
            animation: none;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-start {
            background: #e74c3c;
            color: white;
        }

        .btn-stop {
            background: #95a5a6;
            color: white;
        }

        .btn-export {
            background: #27ae60;
            color: white;
        }

        .btn-clear {
            background: #e67e22;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .record-count {
            color: #555;
            font-weight: bold;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .rooms-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .room-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .room-card:hover {
            transform: translateY(-5px);
        }

        .room-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .room-header h2 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .room-number {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .info-row {
            margin: 15px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .info-label {
            font-weight: bold;
            color: #333;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .info-value {
            color: #555;
            font-size: 1.1em;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.95em;
            margin-top: 5px;
        }

        .status-request {
            background: #ff4757;
            color: white;
            animation: pulse 1.5s infinite;
        }

        .status-normal {
            background: #2ecc71;
            color: white;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .chart-container {
            margin-top: 20px;
            position: relative;
            height: 200px;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2em;
            padding: 50px;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .connected {
            background: #2ecc71;
        }

        .disconnected {
            background: #e74c3c;
        }

        .uid-code {
            font-family: 'Courier New', monospace;
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">ƒêang k·∫øt n·ªëi...</div>
    
    <div class="container">
        <h1>üè• H·ªá Th·ªëng Gi√°m S√°t Ph√≤ng B·ªánh</h1>
        
        <!-- Panel ƒëi·ªÅu khi·ªÉn ghi d·ªØ li·ªáu -->
        <div class="control-panel">
            <div class="recording-status">
                <div class="record-indicator stopped" id="recordIndicator"></div>
                <span id="recordStatus">Ch∆∞a ghi d·ªØ li·ªáu</span>
            </div>
            
            <div class="record-count">
                üìä S·ªë b·∫£n ghi: <span id="recordCount">0</span>
            </div>
            
            <div class="control-buttons">
                <button class="btn btn-start" id="btnStart" onclick="startRecording()">
                    ‚ñ∂Ô∏è B·∫Øt ƒë·∫ßu ghi
                </button>
                <button class="btn btn-stop" id="btnStop" onclick="stopRecording()" disabled>
                    ‚è∏Ô∏è D·ª´ng ghi
                </button>
                <button class="btn btn-export" id="btnExport" onclick="exportToExcel()">
                    üì• Xu·∫•t Excel
                </button>
                <button class="btn btn-clear" onclick="clearData()">
                    üóëÔ∏è X√≥a d·ªØ li·ªáu
                </button>
            </div>
        </div>
        
        <div class="rooms-container" id="roomsContainer">
            <div class="loading">ƒêang t·∫£i d·ªØ li·ªáu...</div>
        </div>
    </div>

    <script>
        // C·∫•u h√¨nh Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD3zKYJxfwWHT9Lv38H7AGfLvnOst76Jj4",
            authDomain: "iotmoni-5b52a.firebaseapp.com",
            databaseURL: "https://iotmoni-5b52a-default-rtdb.firebaseio.com",
            projectId: "iotmoni-5b52a",
            storageBucket: "iotmoni-5b52a.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Kh·ªüi t·∫°o Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Danh s√°ch b·ªánh nh√¢n
        const patients = {
            "710F8005": "Nguy·ªÖn Minh Ph∆∞∆°ng",
            "BEF58005": "Nguy·ªÖn B·∫£o Di·ªáp",
            "06G5H4I3": "L√™ VƒÉn C∆∞·ªùng",
            "07J6K5L4": "Ph·∫°m Th·ªã Dung",
            "08M7N6O5": "Ho√†ng VƒÉn Em",
            "default": "Ch∆∞a c√≥ b·ªánh nh√¢n"
        };

        // Bi·∫øn l∆∞u tr·ªØ d·ªØ li·ªáu
        let charts = {};
        let recordedData = [];
        let isRecording = false;
        let recordingInterval = null;

        // D·ªØ li·ªáu hi·ªán t·∫°i c·ªßa c√°c ph√≤ng
        let currentRoomData = {
            room1: { uid: '', name: '', status: 0, weight: 0, spo2: 0, heartRate: 0, temperature: 0 },
            room2: { uid: '', name: '', status: 0, weight: 0, spo2: 0, heartRate: 0, temperature: 0 },
            room3: { uid: '', name: '', status: 0, weight: 0, spo2: 0, heartRate: 0, temperature: 0 }
        };

        // Theo d√µi tr·∫°ng th√°i k·∫øt n·ªëi
        const connectedRef = database.ref('.info/connected');
        connectedRef.on('value', (snap) => {
            const status = document.getElementById('connectionStatus');
            if (snap.val() === true) {
                status.textContent = '‚óè ƒê√£ k·∫øt n·ªëi';
                status.className = 'connection-status connected';
            } else {
                status.textContent = '‚óè M·∫•t k·∫øt n·ªëi';
                status.className = 'connection-status disconnected';
            }
        });

        // H√†m l·∫•y th·ªùi gian hi·ªán t·∫°i
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleString('vi-VN', { 
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // B·∫Øt ƒë·∫ßu ghi d·ªØ li·ªáu
        function startRecording() {
            isRecording = true;
            document.getElementById('recordIndicator').className = 'record-indicator active';
            document.getElementById('recordStatus').textContent = 'üî¥ ƒêang ghi d·ªØ li·ªáu...';
            document.getElementById('btnStart').disabled = true;
            document.getElementById('btnStop').disabled = false;
            
            // Ghi d·ªØ li·ªáu m·ªói 5 gi√¢y
            recordingInterval = setInterval(() => {
                if (isRecording) {
                    const record = {
                        timestamp: getCurrentTime(),
                        // Ph√≤ng 1
                        phong1_uid: currentRoomData.room1.uid,
                        phong1_ten: currentRoomData.room1.name,
                        phong1_yeucau: currentRoomData.room1.status === 1 ? 'C√≥ y√™u c·∫ßu' : 'Kh√¥ng c√≥ y√™u c·∫ßu',
                        phong1_khoiluong: currentRoomData.room1.weight,
                        phong1_spo2: currentRoomData.room1.spo2,
                        phong1_nhiptim: currentRoomData.room1.heartRate,
                        phong1_nhietdo: currentRoomData.room1.temperature,
                        // Ph√≤ng 2
                        phong2_uid: currentRoomData.room2.uid,
                        phong2_ten: currentRoomData.room2.name,
                        phong2_yeucau: currentRoomData.room2.status === 1 ? 'C√≥ y√™u c·∫ßu' : 'Kh√¥ng c√≥ y√™u c·∫ßu',
                        phong2_khoiluong: currentRoomData.room2.weight,
                        phong2_spo2: currentRoomData.room2.spo2,
                        phong2_nhiptim: currentRoomData.room2.heartRate,
                        phong2_nhietdo: currentRoomData.room2.temperature,
                        // Ph√≤ng 3
                        phong3_uid: currentRoomData.room3.uid,
                        phong3_ten: currentRoomData.room3.name,
                        phong3_yeucau: currentRoomData.room3.status === 1 ? 'C√≥ y√™u c·∫ßu' : 'Kh√¥ng c√≥ y√™u c·∫ßu',
                        phong3_khoiluong: currentRoomData.room3.weight,
                        phong3_spo2: currentRoomData.room3.spo2,
                        phong3_nhiptim: currentRoomData.room3.heartRate,
                        phong3_nhietdo: currentRoomData.room3.temperature
                    };
                    
                    recordedData.push(record);
                    updateRecordCount();
                }
            }, 5000); // 5 gi√¢y
            
            console.log('B·∫Øt ƒë·∫ßu ghi d·ªØ li·ªáu...');
        }

        // D·ª´ng ghi d·ªØ li·ªáu
        function stopRecording() {
            isRecording = false;
            clearInterval(recordingInterval);
            document.getElementById('recordIndicator').className = 'record-indicator stopped';
            document.getElementById('recordStatus').textContent = '‚è∏Ô∏è ƒê√£ d·ª´ng ghi';
            document.getElementById('btnStart').disabled = false;
            document.getElementById('btnStop').disabled = true;
            
            console.log('ƒê√£ d·ª´ng ghi d·ªØ li·ªáu');
        }

        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng b·∫£n ghi
        function updateRecordCount() {
            document.getElementById('recordCount').textContent = recordedData.length;
        }

        // Xu·∫•t d·ªØ li·ªáu ra Excel
        function exportToExcel() {
            if (recordedData.length === 0) {
                alert('Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t! Vui l√≤ng b·∫Øt ƒë·∫ßu ghi d·ªØ li·ªáu tr∆∞·ªõc.');
                return;
            }

            // T·∫°o worksheet
            const ws = XLSX.utils.json_to_sheet(recordedData);
            
            // ƒê·∫∑t ƒë·ªô r·ªông c·ªôt
            ws['!cols'] = [
                { wch: 20 }, // Timestamp
                { wch: 15 }, // UID 1
                { wch: 20 }, // T√™n 1
                { wch: 15 }, // Y√™u c·∫ßu 1
                { wch: 15 }, // Kh·ªëi l∆∞·ª£ng 1
                { wch: 12 }, // SpO2 1
                { wch: 12 }, // Nh·ªãp tim 1
                { wch: 12 }, // Nhi·ªát ƒë·ªô 1
                { wch: 15 }, // UID 2
                { wch: 20 }, // T√™n 2
                { wch: 15 }, // Y√™u c·∫ßu 2
                { wch: 15 }, // Kh·ªëi l∆∞·ª£ng 2
                { wch: 12 }, // SpO2 2
                { wch: 12 }, // Nh·ªãp tim 2
                { wch: 12 }, // Nhi·ªát ƒë·ªô 2
                { wch: 15 }, // UID 3
                { wch: 20 }, // T√™n 3
                { wch: 15 }, // Y√™u c·∫ßu 3
                { wch: 15 }, // Kh·ªëi l∆∞·ª£ng 3
                { wch: 12 }, // SpO2 3
                { wch: 12 }, // Nh·ªãp tim 3
                { wch: 12 }  // Nhi·ªát ƒë·ªô 3
            ];

            // T·∫°o workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'D·ªØ li·ªáu ph√≤ng b·ªánh');

            // T·∫°o t√™n file v·ªõi timestamp
            const fileName = `DuLieuPhongBenh_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.xlsx`;

            // Xu·∫•t file
            XLSX.writeFile(wb, fileName);
            
            console.log('ƒê√£ xu·∫•t file Excel:', fileName);
            alert(`ƒê√£ xu·∫•t ${recordedData.length} b·∫£n ghi ra file ${fileName}`);
        }

        // X√≥a d·ªØ li·ªáu ƒë√£ ghi
        function clearData() {
            if (recordedData.length === 0) {
                alert('Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ x√≥a!');
                return;
            }
            
            if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ${recordedData.length} b·∫£n ghi?`)) {
                recordedData = [];
                updateRecordCount();
                alert('ƒê√£ x√≥a t·∫•t c·∫£ d·ªØ li·ªáu!');
            }
        }

        // T·∫°o giao di·ªán 3 ph√≤ng
        function createRooms() {
            const container = document.getElementById('roomsContainer');
            container.innerHTML = '';

            for (let i = 1; i <= 3; i++) {
                const roomCard = document.createElement('div');
                roomCard.className = 'room-card';
                roomCard.id = `room${i}`;
                
                roomCard.innerHTML = `
                    <div class="room-header">
                        <h2>Ph√≤ng B·ªánh ${i}</h2>
                        <div class="room-number">Room ${i.toString().padStart(3, '0')}</div>
                    </div>
                    
                    <div class="info-row">
                        <div class="info-label">üîñ M√£ b·ªánh nh√¢n (UID)</div>
                        <div class="info-value">
                            <span class="uid-code" id="uid${i}">ƒêang t·∫£i...</span>
                        </div>
                    </div>
                    
                    <div class="info-row">
                        <div class="info-label">üë§ T√™n b·ªánh nh√¢n</div>
                        <div class="info-value" id="name${i}">ƒêang t·∫£i...</div>
                    </div>
                    
                    <div class="info-row">
                        <div class="info-label">üîî Tr·∫°ng th√°i y√™u c·∫ßu</div>
                        <div class="info-value">
                            <span class="status-badge" id="status${i}">ƒêang t·∫£i...</span>
                        </div>
                    </div>
                    
                    <div class="info-row">
                        <div class="info-label">ü©∫ Ch·ªâ s·ªë s·ª©c kh·ªèe</div>
                        <div class="info-value" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;">
                            <div style="text-align: center; padding: 8px; background: #e3f2fd; border-radius: 5px;">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">ü´Å</div>
                                <div style="font-size: 0.85em; color: #1976d2; font-weight: bold;">SpO2</div>
                                <div style="font-size: 1.3em; color: #0d47a1; font-weight: bold;" id="spo2${i}">--</div>
                                <div style="font-size: 0.75em; color: #666;">%</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: #fce4ec; border-radius: 5px;">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">‚ù§Ô∏è</div>
                                <div style="font-size: 0.85em; color: #c2185b; font-weight: bold;">Nh·ªãp tim</div>
                                <div style="font-size: 1.3em; color: #880e4f; font-weight: bold;" id="heartRate${i}">--</div>
                                <div style="font-size: 0.75em; color: #666;">BPM</div>
                            </div>
                            <div style="text-align: center; padding: 8px; background: #fff3e0; border-radius: 5px;">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">üå°Ô∏è</div>
                                <div style="font-size: 0.85em; color: #e65100; font-weight: bold;">Nhi·ªát ƒë·ªô</div>
                                <div style="font-size: 1.3em; color: #bf360c; font-weight: bold;" id="temperature${i}">--</div>
                                <div style="font-size: 0.75em; color: #666;">¬∞C</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="chart${i}"></canvas>
                    </div>
                `;
                
                container.appendChild(roomCard);
                createChart(i);
            }
        }

        // T·∫°o bi·ªÉu ƒë·ªì tr√≤n
        function createChart(roomNumber) {
            const ctx = document.getElementById(`chart${roomNumber}`).getContext('2d');
            
            const centerTextPlugin = {
                id: 'centerText',
                afterDraw: function(chart) {
                    const ctx = chart.ctx;
                    const centerX = (chart.chartArea.left + chart.chartArea.right) / 2;
                    const centerY = (chart.chartArea.top + chart.chartArea.bottom) / 2;
                    
                    ctx.save();
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    ctx.font = 'bold 16px Arial';
                    ctx.fillStyle = '#667eea';
                    ctx.fillText('Milis', centerX, centerY - 15);
                    
                    const value = chart.data.datasets[0].data[0];
                    ctx.font = 'bold 24px Arial';
                    ctx.fillStyle = '#333';
                    ctx.fillText(value + ' kg', centerX, centerY + 15);
                    
                    ctx.restore();
                }
            };
            
            charts[roomNumber] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Kh·ªëi l∆∞·ª£ng', 'C√≤n l·∫°i'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(200, 200, 200, 0.3)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(200, 200, 200, 0.5)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.dataIndex === 0) {
                                        return 'Kh·ªëi l∆∞·ª£ng: ' + context.parsed + ' kg';
                                    }
                                    return '';
                                }
                            }
                        }
                    },
                    cutout: '70%'
                },
                plugins: [centerTextPlugin]
            });
        }

        // C·∫≠p nh·∫≠t d·ªØ li·ªáu t·ª´ Firebase
        function updateRoomData(roomNumber) {
            let uidPath, goiPath, milisPath, spo2Path, heartRatePath, temperaturePath, roomKey;
            
            if (roomNumber === 1) {
                uidPath = '/uid';
                goiPath = '/goi';
                milisPath = '/milis';
                spo2Path = '/spo2';
                heartRatePath = '/heartRate';
                temperaturePath = '/temperature';
                roomKey = 'room1';
            } else if (roomNumber === 2) {
                uidPath = '/uid1';
                goiPath = '/goi1';
                milisPath = '/milis1';
                spo2Path = '/spo21';
                heartRatePath = '/heartRate1';
                temperaturePath = '/temperature1';
                roomKey = 'room2';
            } else if (roomNumber === 3) {
                uidPath = '/uid2';
                goiPath = '/goi2';
                milisPath = '/milis2';
                spo2Path = '/spo22';
                heartRatePath = '/heartRate2';
                temperaturePath = '/temperature2';
                roomKey = 'room3';
            }
            
            // L·∫Øng nghe UID
            database.ref(uidPath).on('value', (snapshot) => {
                const uid = snapshot.val() || "Ch∆∞a qu√©t";
                const uidElement = document.getElementById(`uid${roomNumber}`);
                const nameElement = document.getElementById(`name${roomNumber}`);
                
                if (uidElement) {
                    uidElement.textContent = uid;
                    const patientName = patients[uid] || patients["default"];
                    nameElement.textContent = patientName;
                    
                    // C·∫≠p nh·∫≠t d·ªØ li·ªáu hi·ªán t·∫°i
                    currentRoomData[roomKey].uid = uid;
                    currentRoomData[roomKey].name = patientName;
                }
            });

            // L·∫Øng nghe tr·∫°ng th√°i g·ªçi
            database.ref(goiPath).on('value', (snapshot) => {
                const goi = snapshot.val();
                const statusElement = document.getElementById(`status${roomNumber}`);
                
                if (statusElement) {
                    if (goi === 1) {
                        statusElement.textContent = 'üîî C√≥ y√™u c·∫ßu';
                        statusElement.className = 'status-badge status-request';
                    } else {
                        statusElement.textContent = '‚úì Kh√¥ng c√≥ y√™u c·∫ßu';
                        statusElement.className = 'status-badge status-normal';
                    }
                    
                    // C·∫≠p nh·∫≠t d·ªØ li·ªáu hi·ªán t·∫°i
                    currentRoomData[roomKey].status = goi;
                }
            });

            // L·∫Øng nghe kh·ªëi l∆∞·ª£ng
            database.ref(milisPath).on('value', (snapshot) => {
                let weight = snapshot.val() || 0;
                
                // Chuy·ªÉn gi√° tr·ªã √¢m th√†nh d∆∞∆°ng
                weight = Math.abs(weight);
                
                if (charts[roomNumber]) {
                    const maxWeight = 100;
                    
                    charts[roomNumber].data.datasets[0].data = [
                        weight.toFixed(2),
                        Math.max(maxWeight - weight, 0).toFixed(2)
                    ];
                    charts[roomNumber].update();
                    
                    // C·∫≠p nh·∫≠t d·ªØ li·ªáu hi·ªán t·∫°i
                    currentRoomData[roomKey].weight = parseFloat(weight.toFixed(2));
                }
            });

            // L·∫Øng nghe SpO2
            database.ref(spo2Path).on('value', (snapshot) => {
                const spo2 = snapshot.val() || 0;
                const spo2Element = document.getElementById(`spo2${roomNumber}`);
                
                if (spo2Element) {
                    spo2Element.textContent = spo2;
                    currentRoomData[roomKey].spo2 = spo2;
                }
            });

            // L·∫Øng nghe Nh·ªãp tim
            database.ref(heartRatePath).on('value', (snapshot) => {
                const heartRate = snapshot.val() || 0;
                const heartRateElement = document.getElementById(`heartRate${roomNumber}`);
                
                if (heartRateElement) {
                    heartRateElement.textContent = heartRate;
                    currentRoomData[roomKey].heartRate = heartRate;
                }
            });

            // L·∫Øng nghe Nhi·ªát ƒë·ªô
            database.ref(temperaturePath).on('value', (snapshot) => {
                const temperature = snapshot.val() || 0;
                const temperatureElement = document.getElementById(`temperature${roomNumber}`);
                
                if (temperatureElement) {
                    temperatureElement.textContent = parseFloat(temperature).toFixed(1);
                    currentRoomData[roomKey].temperature = parseFloat(temperature).toFixed(1);
                }
            });
        }

        // Kh·ªüi t·∫°o
        createRooms();
        
        for (let i = 1; i <= 3; i++) {
            updateRoomData(i);
        }
    </script>
</body>
</html>